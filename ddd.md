* 从单点上看,网络的复杂度,取决于单点的流入与流出.拆分单点是个好主意.
$\sum_i f_{ij}(x_{ij})=\sum_iI_{ij}*O_{ij}$,表示第j次优化过程中,每个i节点汇总的复杂度
如果对每个i节点拆分为两个
$f_{i,j}(x_{ij})=f_{i,j}(x_{i_0,j+1}+x_{i_1,j+1})=(I_{i_0,j+1}+I_{i_1,j+1})*(O_{i_0j+1}+O_{i_1j+1})$
$f_{i,j+1}(x_{ij+1})=I_{i_0,j+1}*O_{i_0j+1}+I_{i_1,j+1}*+O_{i_1j+1}+K$
其中K为新节点$i_0$,$i_1$间的关系复杂度.理想情况下为0.一般情况下为1,即${i_0}$节点到${i_1}$

> 也就是说每一类事交给一个节点做,减少不同类事物在同一个地方的影响.但如果不同类事物依然有联系,可能还是以事物的组织为上下文限界.
> 可以将每一个流入到流出确定为一个用例,将相同流入的聚在一起.
* 依赖是可以倒置的,即A->B变为A->C<-B.
> 特别的如果C只是逻辑,那么C就是一个无状态的.此时C就不容易变化(因为没有属性).领域服务就是这个意思.但过多的领域服务,实质是上文的K,所以可能将多个聚为一个,也是好选择.
$f(x)=h(g(x))=>O(g(x)+h(w)+hg)$
如何写好$hg$,需要强大的抽象能力

* 一个用户故事是全流程的.在这个故事的领域,应该被故事的要素都了解.实现这些要素,对人理解领域的要求很高.(系统内部,接口可以不同,但全流程里领域是同一个,虽然流程是事件流)

* 上文将流分为多个,但一个用户故事不只一个流,将这些流聚合在一起,确立一个边界.


新手,问一下,写代码要知道领域是什么样子的.
前后端只是访问有领域的速度有延迟,但其实都是通过外部接口,用例访问领域.
都要知道领域是什么样子的.

虽然前端是通过外部接口,用例访问领域,但是
问,暴露领域知识不好.
但我建议都了解领域知识,这样无论写用例,接口时,大家坐下来讨论的是同一个东西.(虽然可能 有些关注的是方法,有些是字段)
  是我哪里理解有偏差吗?


# math

* $\mathbb P$ is 范式集(元素集),
* $C_P$ is 关于判定函数,
$p\in \mathbb P$ if $C_P(p)=true$

* $\mathbb O$ is 对象集
* $\mathbb M$ is 方法集
$m\in \mathbb M$ if $M(p)=true$
$m\in \mathbb M_o$ if $M(p,o)=true,o\in \mathbb O$

> Member(m,o),Member(m)
> Methor(m,o)

* 问题空间$\mathbb P$
$\triangleq$
$\mathbb P_{价值需求}$
 or
$\mathbb P_{业务需求}$

* 解空间$\mathbb S$
$\triangleq$

$S_{组织} \triangleq 系统上下文$

$S_{业务} \triangleq 限界上下文+通用语言$

$S_{系统} \triangleq 系统分层$

$
Domain=\bigoplus SubDomain \bigoplus DomainService
$

$
SubDomain=支撑子域 \bigoplus_{限界上下文} 通用子域 \bigoplus_{限界上下文} 核心域$
$

$
SubDomain=\bigoplus {限界上下文}
$

$
限界上下文= 聚合根 \bigoplus 领域事件 \bigoplus 值对象 
$

限界上下文 除了解决集成的问题,还可以促进团队间交流

限界上下文 has (客户方-供应方,遵奉者,大泥球)

name(BC) part of 能用语言

$
D_{A_{BC_{核心域}}} \rightleftharpoons_{交互} 
D_{B_{BC_{通用域}}}
$

实体唯一标识的方法=(用户提供唯一标识,应用程序生成唯一标识,持久化机制生成,另一个限界上下文提供)
> 时间很重要

委派标识,生成两种标识,分别给领域和orm用

实体 只要属性修改,标识就改变.实体变化可以用(存储领域事件记录)
> 但值对象呢?值对象类型和属性都相等 则 值对象相等

why use Entity?文档=>通用语言=>代码之后,文档就不好维护
通用语言=(术语,文档,用例场景,代码)

聚合 
原则: 
1. 设计小聚合,避免事务成本,聚合用例可能没有考虑并发,和运行失败
2. 唯一标识引用其他聚合
3. 边界之外使用最终一致性
4. 避免依赖注入(可能会实质上是大泥球,)
5. 使用乐观并发(版本+1)
> 领域事件包含聚合标识
> 聚合--一个拥有事务一致性的组合单元(业务)

> 边界内事务一致性?
> 拆分成小聚合后,圈出那些真正不变的条件,保证它们最终一致性
> 根实体
> 可能不要依赖注入聚合就可以了,可以注入值对象?